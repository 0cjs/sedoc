Commit Messages
===============

The primary purpose of commit messages is to efficiently communicate with
other developers. This purpose supersedes any rules or guidelines: don't
let rules or guidelines get in the way of achieving it.

The basic idea starts with the classic CBEAMS blog post ["How to Write a
Git Commit Message"][cbeams]. Most of that is not repeated here; if you've
not read it before it's well worth reading (or re-reading).

An important point to remember when writing commit messages (or writing
anything) is to write for your specific _audience:_ within a project you
know who else is going to be reading what you write and generally what they
know, so tailor your writing to communicate to them, not to a random
programmer on the Internet. New programmers to a project will learn the
conventions, which is more efficient than trying to explain things to
people who know nothing about what you're doing.

Another important thing to consider is the relationship between the
commits. Ideally, for easiest review, you want a series of commits to tell
a story in easy-to-review steps, separating reformattings, refactorings,
API changes, new code using those new APIs, and the like.

Below, git commands marked with '†' are available from [`gitcmd-abbrev`].
If you're not using this that's no problem; a standard `git` command is
always given as an alternative.


Review Procedure
----------------

A primary purpose of good commit messages is to make reviews easier and
_faster._ A standard review procedure is to look at just the summary lines
to get an overview of what's in the commits and then digging down into
individual commits only where that's useful. E.g., you might completely
ignore a commit whose summary line indicates it's just a reformatting, look
at just the full commit message and changed files for something where you
want to be more sure about the overall effect of the change, and carefully
examine the diff of a commit where you need to verify the code.

      #   Check out development branch.
      git fetch
      git checkout dev/fred/2025-11-03/some-feature
      git rebase

      #   Examine summaries of commits just on this dev branch.
      git log --oneline main@{upstream}..
    † logb main@{u}..

      #   Look at more details of commits we're interested in.
      git log -1 --stat 12ab34cd
    † logs -1 12ab34cd

      #   Look at the full diff for commits we're _really_ interested in.
      git log -1 --stat --patch 12ab34cd
    † slp1 12ab34cd

Similar procedures can be done in graphical interfaces such as the
GitHub/GitLab web interfaces.


The Components of a Commit
--------------------------

A Git commit consists of several parts:
1. The _summary line,_ which is the first paragraph of the commit message,
   separated from the remainder by a blank line. (All the lines in the
   first paragraph are joined into a single summary line by most tools.)
2. The _body_ of the commit message; as many paragraphs as necessary to
   give all the details about the commit.
3. _Trailers,_ one line each, such as "Co-authored-by: …", "Reviewed-by: …".
4. The list of changed files (generated by †`logs` or `git log --stat`).
5. The patch (a diff between the commit and its parent), generated by
   †`logp` or `git log --patch`. Note that this is generated on the fly;
   the commit itself contains no patches but the contents of all files in
   the repo.

### Summary Line

The summary line I suggest using has a couple of additional items beyond
the summary mentioned in [[cbeams]].

1. An optional _status marker,_ in upper case, not followed by a colon.
   Typical status markers include:
   - `WIP`: Work in progress, indicating that it's only partially completed
     or working and you expect to amend the commit. Normally this should
     only ever appear on development branches; the `WIP` would be removed
     once the commit is in a working state.
   - `FIXUP`: The commit changes something in a previous commit and is
     intended to be squashed into that previous commit. This should never
     appear on other than development branches; it's there either because
     you've not yet gotten around to doing the squash or because you want
     to temporarily leave that change in a separate commit for easier
     review by others.
   - `BROKEN`: The commit is not passing tests. Usually this should be
     fixed before the commit is merged to `main`, but for emergency fixes
     it may go to `main` first and then be fixed later.
   - `UNBROKEN`: Fixes a known broken commit on `main`.
   - Make up your own if you see a need! If it's obvious, others will
     understand; if not, but it's useful, the team can all learn about it
     (or reject it as a silly idea and mock you :-P).

2. A _locator,_ followed by a colon, that gives other developers some sense
   of what code is being changed. This might be a file name, a module name,
   or anything else that the other developers within the project will
   understand. It's typical drop file extensions where they're obvious, use
   `//` to elide an obvious series of directory names, or `..` or similar
   for the same with module names. It's also typical to drop test files
   (obviously you've written a test, right?), documentation files (unless
   it's just docs you're updating), and so on. Examples:
   - `doc/commit-messages: …`: Updating `doc/commit-messages.md` and the
     top-level `README.md` that now references it.
   - `xyz//LoginPage: …`: where `app/web/xyz/` is well known to be an
     application under `app/web/`, and `LoginPage.tsx` is easily found
     under it. It might also change `common/foo/constants.ts`, but taht
     level of detail probably isn't necessary for a summary line.
   - `bingo/: Remove unnecessary markdown files`: Anybody who needs to know
     the specific files can check the exact list of changed files.

3. A _summary message:_ a one-line overview of the change. This can be very
   difficult to write: often it's easier to write the detailed commit
   message first, and then write the summary based on that. There's more in
   [[cbeams]], but remember you primary purpose is to communicate with
   other developers in this project, so break any rules he gives when
   necessary. (In particular, if it takes 70 or 80 chars for a good summary
   line, don't do a bad one just to try to fit it in 50.)

### Body

Get as detailed as you need to in here to explain _why_ you're making this
change. Feel free to include links to external documentation.

Remember that some things may be important enough that they should go in
comments in the code rather than the commit message, e.g., things along the
lines of "X looks wrong, but do _not_ change it because bad thing Y will
happen."

### Trailers

Trailers should be at the end of the commit message, separated by a blank
line. Names and e-mail addresses should be the same as the commit `Author:`
line commonly used by that developer. An example using common trailers:

    Co-authored-by: Curt J. Sampson <cjs@cynic.net>
    Reviewed-by: Wendel Clark <wendel@saskatoon.blades>
    Signed-off-by: Guy Lafleur <lafleur@remparts.qc>
    Tested-by: Mario Lemieux <lemieux@laval.qc>

(These can be generated easily by †`gctr`; run the command without any
parameters to see help.)

### Changed Files

The list is generated automatically when viewing commits with †`logs` or
`git log --stat`. (There are various options to `--stat` and related
options to change the diffstat output format; see the manpage for
`git-log`.)

### Patch

†`logp` and `git log --patch` (or `-p`) will print the diff of the commit
and its parent. (Note that this does not work for merge commits.)



<!-------------------------------------------------------------------->
[cbeams]: https://cbea.ms/git-commit/
[`gitcmd-abbrev`]: https://github.com/dot-home/gitcmd-abbrev
