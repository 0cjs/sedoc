| [Overview](README.md) | [Async](async.md)
| [NPM](npm.md) | [NPM Files](npm-files.md) | [Jest](jest.md)
|

NPM Package Configuration Files
===============================

Module Definition: `package.json`
---------------------------------

[`package.json`] is not a required file; you can `npm install`
specific packages into `node_modules/` under the CWD even if it
doesn't exist.

The `package.json` for installed packages under `node_modules` will
have additional information (in fields starting with `_`) added by NPM
during install about the source and installation of the module.

#### [Dependency Fields]

The following fields specify dependencies:
- `dependencies`: Required for use of the package (as library or script)
- `devDependencies`: For building and testing;
  installed by default by `npm link` or `install`
- `peerDependencies`: Minimum versions of plugins; not installed by default
- `bundledDependencies`: Bundled when publishing the package by `npm pack`
- `optionalDependencies`: Proceed with warning if not available
  (your software needs to handle package absence)

Dependencies are a map of `{ "name": "SPEC" }`, where the spec is
a version spec or direct download specifier.

Version specifiers are [semver]s, including:
- `x`, `x.y`, `x.y.z`
- `''`, `*`: any version
- `>`, `>=`, `<`, `<=` prefixes
- `~` prefix for approximate equivalance
  - patch-level changes if minor version given: `~1.2.3` = `>=1.2.3 <1.3.0`
  - minor version changes if only major version given `~1` = `>=1.0.0 <2.0.0`
- `^` prefix for "compatible with":
  Changes must not modify left-most non-zero digit.
- `v1 - v2`: range
- `range1 || range2`: either range must be satisfied

Other specifiers are:
- `https://.../package.tar.gz`: URL to tarball
- `git+https://...`: URL to Git repo (also `git`, `git+ssh`, `git+file`, etc.).
  Add `#commit-ish` or `#semver:SEMVER` for a specific version.
  The commit-ish may need slashes escaped with `\`.
- `user/project`: GitHub repo. Optional version as with `git`.
- `./foo/bar`: Local path, starting with `../`, `./`, `~/`, `/` or `file:`.

#### Other Common Fields

- `name`: (required)
  - Cannot start with `.` or `_`; no uppercase; URL-safe.
  - Do not put `js` or `node` in the name. (Use `engines` if not for node.)
  - Don't use names already in <https://www.npmjs.com>.
- `version`: (required) A semver.
- `private`: (default `false`) If `true`, npm will not publish and will
  disable some lint checks for license etc. See also `publishConfig`.
- `license` (default `ISC`) Use a license from the [SPDX License List],
  `SEE LICENSE IN <filename>` or `UNLICENSED`.


Dependency Locking: `package-lock.json` and `npm-shrinkwrap.json`
-----------------------------------------------------------------

The `node_modules/` directory generated by NPM from a [`package.json`]
will vary depending on the particular versions of modules currently
available and the particular dependency resolution algorithm used in
your version of NPM. [Package locks] are used to ensure that a
previously generated `node_modules/` can be exactly regenerated for
testing and release.

However, because NPM silently falls back to standard package
resolution if the version in the lockfile is not available, a rebuild
is not entirely deterministic. In this case the lock file will be
updated with the different version that was actually installed.

### npm-shrinkwrap.json and package-lock.json

The locked configuration is stored in either [`npm-shrinkwrap.json`]
or [`package-lock.json`]. (Both use the same format.) `npm-shrinkwrap`
will always take priority, if present, causing `package-lock` to be
ignored. The locked configuration includes the exact versions of
packages that were installed and cached package metadata (source URL,
integrity hash, etc.).

NPM will update the lockfile automatically for most operations that
change the `node_modules/` tree or `package.json` (e.g., `npm install
--save-prod`). The lockfile should always be committed after testing
the new configuration.

`package-lock.json` is intended to record the last known-good
configuration for development/testing etc.; it will be created/updated
by `npm install` and other commands that manipulate `node_modules/`.
This is never included when a package is published. Unless you're
using `npm-shrinkwrap.json` this file should always be committed.

`npm-shrinkwrap.json` is intended to lock down the configuration of a
(stand-alone) application and should not be used for modules imported
by other applications or libraries. It is initially created by the
`npm shrinkwrap` command (which will deal with a pre-existing
`package-lock.json` by moving it to `npm-shrinkwrap.json`). Otherwise
it functions in the same way as `package-lock.json` except that it
will be included in published packages.

### Shrinkwrap Inconsistencies

Depending on the circumstances under which `npm-shrinkwrap.json` was
generated, the contents may differ even for the exact same set of
packages and versions. (This may already be fixed in later versions of
NPM.)

One difference that can appear (discussed in detail in [issue 9550])
is that `from:` field in a package lockfile, which may be taken from
`_resolved:` and/or `_from:` in `node_modules/.../package.json` when
NPM updates the package lock file. It may contain:

1. The name and resolved version number (`async@1.4.2`) if the update
   was done due to an explicit install of the package (`npm install
   --save-prod async`)
2. The resolved package URL from `node_modules/.../package.json` if
   the update was done with the package already installed (`npm
   shrinkwrap`).

The [npm-shrinkwrap package] is a way of fixing this, though it
appears not to work with NPM â‰¥ 3.x. (Perhaps because it's no longer
necessary?)



[`npm-shrinkwrap.json`]: https://docs.npmjs.com/files/shrinkwrap.json
[`package-lock.json`]: https://docs.npmjs.com/files/package-lock.json
[`package.json`]: https://docs.npmjs.com/files/package.json
[issue 9550]: https://github.com/npm/npm/issues/9550
[npm-shrinkwrap package]: https://github.com/uber/npm-shrinkwrap
