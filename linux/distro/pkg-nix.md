Nix Package Manager
===================

[NixOS] is a Linux distribution that uses the [Nix] package manager and the
[Nixpkgs] channel. However, Nix itself requires neither of these and can be
used standalone on any Linux distro or MacOS.


Installation
------------

* __Debian:__ `apt-get install nix-bin` and add yourself to the `nix-users`
  group. (The `nix-setup-systemd` package for the Nix daemon will be
  included as a recommendation unless you specifically exclude it.)
* __Arch:__ `nix` and `archlinux-nix` packages available, but seems to
  require [some manual configuration][arch].
* __Vendor:__ [Binary install][nix instbin] typically via `sh <(curl -L
  https://nixos.org/nix/install) --daemon`, or [build from source][nix
  instsrc]


Overview
--------

Paths:

    /nix/store/             object store
    /nix/var/nix/profiles/  profile symlinks into /nix/store/*-environment
    ~/.nix-profile          symlink to /nix/var/nix/profiles/per-user/...
    ~/.nix-channels         file listing channels
    ~/.nix-defexpr/         (see nix-env(1) manpage)

Most Nix package-related information outside `/nix/store/` is just symlinks
into that object store. In a "multi-user" configuration all changes to
`/nix/` are handled by the Nix daemon, which also has its own user IDs for
building things. Nix can also be used in a "single-user" configuration
where `/nix/` is owned by a user.

Nix packages are are instances of a more general object, the _derivation_,
which is anything generated by a build action (including downloaded source,
intermediate build products, profiles, channel information, etc.). These
are generated by evaluating _expressions_ in the pure, lazy, functional
[Nix expression language][nix expr]. Derivations are stored under
`/nix/store/` in files named for an SHA256 of the inputs followed by a
(human-readable) symbolic name that is used by `nix-env`.

### Profiles

`~/.nix-profile/` will point through several symlinks to an environment in
the store that provides a standard Unix $PREFIX hierarchy (`bin/`,
`share/`, etc.).


### Useful Commands

`--dry-run` and `-v` (verbose) options available on pretty much everything.

    sudo nix-daemon --daemon &  # start daemon in docker container
    nix ping-store      # (no args) check if daemon is running and accessible
    nix-env -qa         # Query packages; -a = all (uninstalled too; slow)

    #   Nixpkgs "standard library"
    nix-channel --add https://nixos.org/channels/nixpkgs-unstable
    nix-channel --update

    nix-store --gc --print-roots
    nix-store --gc --print-live


Channels
--------


Misc
----

- Nixpkgs offers a `dockerTools` package to help automate [building Docker
  images][docker].



<!-------------------------------------------------------------------->
[NixOS]: https://nixos.org/manual/nixos/stable/
[Nix]: https://nixos.org/manual/nix/stable/
[Nixpkgs]: https://nixos.org/manual/nixpkgs/stable/

[arch]: https://wiki.archlinux.org/title/Nix
[nix expr]: https://nixos.org/manual/nix/stable/#ch-expression-language
[nix instsrc]: https://nixos.org/manual/nix/stable/#ch-installing-source
[nix instbin]: https://nixos.org/manual/nix/stable/#ch-installing-binary

[docker]: https://nix.dev/tutorials/building-and-running-docker-images
